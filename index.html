<html>
    <head>
        <title>TVM Calculator</title>
        <script>
            function getValues() {
                var n = document.forms["TVM"]["n"].value*1;
                var I = document.forms["TVM"]["I"].value*1;
                var PV = document.forms["TVM"]["PV"].value*1;
                var PMT = document.forms["TVM"]["PMT"].value*1;
                var FV = document.forms["TVM"]["FV"].value*1;
                var PY = document.forms["TVM"]["P/Y"].value*1;
                var CY = document.forms["TVM"]["C/Y"].value*1;

                var i = fromI(I,PY,CY);

                return {
                    n:n,
                    i:i,
                    PV:PV,
                    PMT:PMT,
                    FV:FV,
                    PY:PY,
                    CY:CY
                };

            }

            function findPV() {
                var tvm = getValues();
                document.forms["TVM"]['PV'].value = calcPV(tvm);
            }

            function calcPV(tvm) {
                var PV = (tvm.PMT/tvm.i - tvm.FV)*(1+tvm.i)**(-tvm.n) - tvm.PMT/tvm.i;
                return PV.toString().substr(0,11);;
            }

            function findPMT() {
                var tvm = getValues();
                var PMT = -tvm.i*(tvm.PV+tvm.FV*(1+tvm.i)**(-tvm.n))/(1-(1+tvm.i)**(-tvm.n));
                document.forms["TVM"]['PMT'].value = PMT.toString().substr(0,9);
            }

            function findFV() {
                var tvm = getValues();
                var FV = tvm.PMT/tvm.i - (tvm.PV+tvm.PMT/tvm.i)/((1+tvm.i)**(-tvm.n));
                document.forms["TVM"]['FV'].value =  FV.toString().substr(0,11);;
            }

            function findN() {
                var tvm = getValues();
                var n =(Math.log((tvm.PMT-tvm.FV*tvm.i)/(tvm.PMT+tvm.PV*tvm.i)))/Math.log(1+tvm.i);
                document.forms["TVM"]['N'].value =  n.toString().substr(0,7);;
            }

            function findI() {
                var tvm = getValues();
                var I = 1;

                var test = {...tvm};
                test.i = fromI(I,tvm.PY, tvm.CY);
                
                var goal = tvm.PV;
                var trial = calcPV(test);
                while (trial-goal > 0)
                {
                    I += 1;
                    test.i = fromI(I, tvm.PY, tvm.CY);
                    trial = calcPV(test);
                }
                I -= 1;
                test.i = fromI(I, tvm.PY, tvm.CY);
                trial = calcPV(test);

                while (trial-goal > 0)
                {
                    I += 0.1;
                    test.i = fromI(I, tvm.PY, tvm.CY);
                    trial = calcPV(test);
                }
                I -= 0.1;
                test.i = fromI(I, tvm.PY, tvm.CY);
                trial = calcPV(test);
                
                while (trial-goal > 0)
                {
                    I += 0.01;
                    test.i = fromI(I, tvm.PY, tvm.CY);
                    trial = calcPV(test);
                }
                I -= 0.01;
                test.i = fromI(I, tvm.PY, tvm.CY);
                trial = calcPV(test);
                
                while (trial-goal > 0)
                {
                    I += 0.001;
                    test.i = fromI(I, tvm.PY, tvm.CY);
                    trial = calcPV(test);
                }
                I -= 0.001;
                test.i = fromI(I, tvm.PY, tvm.CY);
                trial = calcPV(test);
                
                while (trial-goal > 0)
                {
                    I += 0.0001;
                    test.i = fromI(I, tvm.PY, tvm.CY);
                    trial = calcPV(test);
                }
                I -= 0.0001;
  
                document.forms["TVM"]['I'].value = I.toString().substr(0,7);
            }

            function toI(i, PY, CY) {
                return (((1+i)**(PY/CY))-1)*CY*100;
            }

            function fromI(I, PY, CY) {
                return (1 + (I/(100*CY)))**(CY/PY) - 1;
            }
        </script>
    </head>
    <body>
        <p>Time-Value of Money Calculator for FSP General Mathematics</p>
        <form name="TVM">
            <label for="n">n = </label> 
            <input type="text" id="n" name="n" value="0">
            <input type="button" onclick="findN()" value = "Solve for n"></br>
    
            <label for="n">I% = </label>
            <input type="text" id="I" name="I" value="0">
            <input type="button" onclick="findI()" value = "Solve for I%"></br>
    
            <label for="n">PV = </label>
            <input type="text" id="PV" name="PV" value="0">
            <input type="button" onclick="findPV()" value = "Solve for PV"></br>
    
            <label for="n">PMT = </label>
            <input type="text" id="PMT" name="PMT" value="0">
            <input type="button" onclick="findPMT()" value = "Solve for PMT"></br>
    
            <label for="n">FV = </label>
            <input type="text" id="FV" name="FV" value="0">
            <input type="button" onclick="findFV()" value = "Solve for FV"></br>
    
            <label for="n">P/Y = </label>
            <input type="text" id="PY" name="P/Y" value="1"></br>
    
            <label for="n">C/Y = </label>
            <input type="text" id="CY" name="C/Y" value="1">
        </form>
    </body>
    
</html>
